variables:
  projects: 'database/bizca.dacpac/bizca.dacpac.sqlproj'
  artifactName: "dacpac"
  buildConfiguration: 'Release'

trigger:
  branches:
    include: [ 'develop', 'master', 'feature', 'release/*', 'hotfix/*' ]
  paths:
    include: [ 'database/bizca.dacpac' ]

name: $(Year:yyyy).$(Month).$(DayOfMonth)$(Rev:.r)

steps:
- task: DotNetCoreCLI@2
  displayName: 'build dacpac'
  inputs:
    command: build
    configuration: '$(buildConfiguration)'
    projects: '$(projects)'

- task: DotNetCoreCLI@2
  displayName: 'publish dacpac'
  inputs:
    command: publish
    projects: '$(projects)'
    zipAfterPublish: false
    publishWebProjects: false
    arguments: '--configuration $(buildConfiguration) --output $(Build.BinariesDirectory)/data'

- task: CopyFiles@2
  inputs:
    SourceFolder: '$(Build.BinariesDirectory)/data'
    Contents: |
      *.dacpac
    TargetFolder: '$(build.ArtifactStagingDirectory)/data'
    OverWrite: true
    
- task: PublishBuildArtifacts@1
  inputs:
    PathtoPublish: '$(Build.ArtifactStagingDirectory)/data'
    ArtifactName: '$(artifactName)'
    publishLocation: 'Container'



